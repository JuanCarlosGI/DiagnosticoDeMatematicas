@model DiagnosticoDeMatematicas.Models.ViewModels.StatisticsViewModel
@using DiagnosticoDeMatematicas.Helpers.IEvaluator

@{
    ViewBag.Title = Model.ExamAnalyzer.Exam.Name;
    var questionResponses = Model.ExamAnalyzer.QuestionResponses;
}

<h2>@Model.ExamAnalyzer.Exam.Name</h2>
<dl class="dl-horizontal">
    @if (Model.ExamAnalyzer.StartDate.HasValue)
    {
        <dt>
            @Html.DisplayNameFor(m => m.ExamAnalyzer.StartDate)
        </dt>

        <dd>
            @Html.DisplayFor(m => m.ExamAnalyzer.StartDate)
        </dd>
    }
    @if (Model.ExamAnalyzer.EndDate.HasValue)
    {
        <dt>
            @Html.DisplayNameFor(m => m.ExamAnalyzer.EndDate)
        </dt>

        <dd>
            @Html.DisplayFor(m => m.ExamAnalyzer.EndDate)
        </dd>
    }
</dl>

<dl class="dl-horizontal">
    <dt>
        @Html.DisplayNameFor(m => m.ExamAnalyzer.AverageGrade)
    </dt>

    <dd>
        @Html.DisplayFor(m => m.ExamAnalyzer.AverageGrade)
    </dd>

    <dt>
        @Html.DisplayNameFor(m => m.ExamAnalyzer.AmountOfResponses)
    </dt>

    <dd>
        @Html.DisplayFor(m => m.ExamAnalyzer.AmountOfResponses)
    </dd>
</dl>

<img src="data:image/png;base64,@Model.ColumnChart()" />

<h2>Información por reactivo</h2>
@{ 
    var counter = 0;
    var evaluator = new NotationlessEvaluator();
}
@foreach (var question in Model.ExamAnalyzer.Exam.Questions)
{
    counter++;
    var questionNotation = evaluator.Evaluate(question);
    var options = questionResponses[question.Id];
    var totalResponses = (options.Item1 + options.Item2 + options.Item3 + options.Item4) * 1.0;

    <div class="panel panel-primary">
        <div class="panel-body">
            <h4>@counter) @questionNotation.Description</h4>
        </div>

        <div class="panel-footer">
            <div class="row">
                <div class="col-lg-3 col-sm-6">
                    <h3 class="text-success">@($"{options.Item1/totalResponses*100:n2}")%</h3>
                    <dl>
                        TO DO
                    </dl>
                </div>

                <div class="col-lg-3 col-sm-6">
                    <h3 class="text-warning">@($"{options.Item2/totalResponses*100:n2}")%</h3>
                    <dl>
                        TO DO
                    </dl>
                </div>

                <div class="col-lg-3 col-sm-6">
                    <h3>@($"{options.Item3/totalResponses*100:n2}")%</h3>
                    <dl>
                        TO DO
                    </dl>
                </div>

                <div class="col-lg-3 col-sm-6">
                    <h3 class="text-danger">@($"{options.Item4/totalResponses*100:n2}")%</h3>
                    <dl>
                        TO DO
                    </dl>
                </div>
            </div>
        </div>
    </div>
}
